<!DOCTYPE html>
<html lang="id">
<head>
    <meta name="monetag" content="100652b48dc4275be673cdeb43648e64">
    <meta name="google-site-verification" content="P3YGHZCaE9-ETe_ESuUs491p6Ytg0krlNd_wGW3KECo" />
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>XOX Siber - Game Tic-Tac-Toe Modern</title>

    <meta name="description" content="Mainkan game Tic-Tac-Toe (XOX) modern bergaya siber di papan 5x5 yang lebih besar. Tantang AI canggih dalam mode 1 pemain atau teman Anda dalam mode 2 pemain.">
    <meta name="keywords" content="tic tac toe, xox, game siber, game modern, game 2 pemain, game gratis, game online, permainan siber, AI game, Minimax, tebak-tebakan, 5x5 tic tac toe, extended tic tac toe">
    <meta name="author" content="Gemini AI">

    <meta property="og:title" content="XOX Siber - Game Tic-Tac-Toe Modern">
    <meta property="og:description" content="Mainkan game Tic-Tac-Toe (XOX) modern bergaya siber di papan 5x5 yang lebih besar. Tantang AI canggih dalam mode 2 pemain.">
    <meta property="og:image" content="https://cs.gstatic.com/gemini/multimodality/tic-tac-toe.jpg">
    <meta property="og:url" content="URL_GAME_ANDA_DI_SINI">
    <meta property="og:type" content="website">
    
    <link rel="icon" href="https://cs.gstatic.com/gemini/multimodality/tic-tac-toe.jpg" type="image/jpeg">

    <script async src="https://www.googletagmanager.com/gtag/js?id=G-KF6MR71D9W"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-KF6MR71D9W');
    </script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Konfigurasi kustom Tailwind */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;700&family=Space+Mono:wght@400;700&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #0A0A0A; /* Latar belakang gelap pekat */
            /* Menambahkan pola grid siber menggunakan gradient CSS */
            background-image:
                repeating-linear-gradient(0deg, rgba(52, 211, 153, 0.05) 0px, transparent 1px, transparent 20px), /* Garis horizontal (nuansa hijau) */
                repeating-linear-gradient(90deg, rgba(96, 165, 250, 0.05) 0px, transparent 1px, transparent 20px); /* Garis vertikal (nuansa biru) */
            background-size: 20px 20px; /* Ukuran kotak grid */
            background-position: center center;
            background-attachment: fixed;
            position: relative;
            z-index: 0; /* Memastikan body adalah lapisan paling bawah */
        }
        body::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5); /* Overlay gelap untuk menjaga kontras dan kedalaman */
            z-index: -1; /* Pastikan di belakang konten */
        }
        .font-cyber {
            font-family: 'Space Mono', monospace;
        }
        /* Efek glow untuk teks dan elemen aktif */
        .glow-text-green {
            text-shadow: 0 0 5px #34D399, 0 0 10px #34D399, 0 0 15px #34D399; /* green-400 */
        }
        .glow-text-blue {
            text-shadow: 0 0 5px #60A5FA, 0 0 10px #60A5FA, 0 0 15px #60A5FA; /* blue-400 */
        }
        .glow-border-green {
            box-shadow: 0 0 8px #34D399; /* green-400 */
        }
        .glow-border-blue {
            box-shadow: 0 0 8px #60A5FA; /* blue-400 */
        }
        .glow-button {
            box-shadow: 0 0 8px #A78BFA, 0 0 15px #A78BFA; /* violet-400 */
            transition: all 0.3s ease-in-out;
        }
        .glow-button:hover {
            box-shadow: 0 0 15px #A78BFA, 0 0 25px #A78BFA, 0 0 35px #A78BFA;
            transform: translateY(-2px);
        }
        /* Menyembunyikan scrollbar untuk tampilan yang lebih bersih */
        ::-webkit-scrollbar {
            display: none;
        }
        html, body {
            overflow: hidden;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
            padding: 2rem 1rem;
        }

        /* Adjust cell size for larger board */
        .game-cell {
            width: 12vw; /* Use viewport width for responsiveness */
            height: 12vw;
            max-width: 60px; /* Max size for larger screens */
            max-height: 60px;
        }
        @media (min-width: 768px) {
            .game-cell {
                width: 70px;
                height: 70px;
            }
        }
        @media (max-width: 480px) {
            .game-cell {
                width: 17vw;
                height: 17vw;
                font-size: 1.8rem; /* Smaller text for smaller cells */
            }
        }

        /* Adjust grid layout for dynamic board size */
        .grid-custom-cols {
            grid-template-columns: repeat(var(--board-size), minmax(0, 1fr));
        }

        /* BARU: Style untuk pop-up reward */
        .reward-popup {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            backdrop-filter: blur(5px);
            -webkit-backdrop-filter: blur(5px);
        }
        .reward-popup-content {
            background-color: #1A1A1A;
            border: 2px solid #60A5FA;
            border-radius: 10px;
            padding: 2rem;
            text-align: center;
            box-shadow: 0 0 20px rgba(96, 165, 250, 0.5);
            max-width: 90%;
            width: 400px;
        }

        /* BARU: Style untuk Shop Modal */
        .shop-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.85);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1001;
            backdrop-filter: blur(8px);
            -webkit-backdrop-filter: blur(8px);
            overflow-y: auto; /* Allow scrolling if shop content is long */
        }
        .shop-modal-content {
            background-color: #1A1A1A;
            border: 2px solid #A78BFA;
            border-radius: 15px;
            padding: 2rem;
            text-align: center;
            box-shadow: 0 0 30px rgba(167, 139, 250, 0.7);
            max-width: 95%;
            width: 700px;
            max-height: 90vh; /* Max height for scrolling */
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
        }
        .shop-items-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 1rem;
            justify-items: center;
        }
        .shop-item {
            background-color: #0A0A0A;
            border: 1px solid #4B5563; /* Gray-600 */
            border-radius: 8px;
            padding: 0.8rem;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 0.5rem;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s ease-in-out;
        }
        .shop-item:hover {
            border-color: #60A5FA; /* Blue glow on hover */
            box-shadow: 0 0 10px rgba(96, 165, 250, 0.5);
            transform: translateY(-3px);
        }
        .shop-item.unlocked {
            border-color: #34D399; /* Green glow for unlocked */
            box-shadow: 0 0 10px rgba(52, 211, 153, 0.5);
        }
        .shop-item.selected {
            border: 3px solid #A78BFA; /* Violet glow for selected */
            box-shadow: 0 0 15px rgba(167, 139, 250, 0.8);
            transform: scale(1.03);
        }
        .shop-item img {
            width: 80px;
            height: 80px;
            object-fit: contain;
            border-radius: 4px;
        }
        .shop-item-price {
            display: flex;
            align-items: center;
            gap: 0.25rem;
            color: #EAB308; /* Amber-500 for gold */
        }
        .shop-item-price svg {
            width: 16px;
            height: 16px;
            fill: currentColor;
        }
        .shop-item button {
            padding: 0.4rem 0.8rem;
            border-radius: 5px;
            font-size: 0.9rem;
            font-weight: bold;
            transition: background-color 0.2s;
        }
        .shop-item button.buy-button {
            background-color: #60A5FA; /* Blue-400 */
            color: #1A1A1A;
        }
        .shop-item button.buy-button:hover {
            background-color: #3B82F6; /* Blue-500 */
        }
        .shop-item button.select-button {
            background-color: #A78BFA; /* Violet-400 */
            color: #1A1A1A;
        }
        .shop-item button.select-button:hover {
            background-color: #8B5CF6; /* Violet-500 */
        }
        .shop-item .selected-text, .shop-item .unlocked-text {
            color: #34D399; /* Green-400 */
            font-weight: bold;
            font-size: 0.9rem;
        }
        .shop-item .selected-text {
            color: #A78BFA; /* Violet-400 */
        }
        .current-coins {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 1.2rem;
            font-weight: bold;
            color: #EAB308; /* Amber-500 */
            margin-bottom: 1rem;
            justify-content: center;
        }
        .current-coins svg {
            width: 20px;
            height: 20px;
            fill: currentColor;
        }
        /* Style untuk gambar X/O di sel game */
        .game-cell img {
            width: 80%; /* Adjust as needed */
            height: 80%; /* Adjust as needed */
            object-fit: contain;
            user-select: none;
            -webkit-user-drag: none;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }
    </style>
</head>
<body class="bg-gray-950 text-gray-200">

    <script async="async" data-cfasync="false" src="//your.monetag.vignette.script.js"></script>
    <script async="async" data-cfasync="false" src="//your.monetag.popunder.script.js"></script>
    <div class="container mx-auto p-4 flex flex-col items-center justify-center min-h-screen">
        <h1 class="text-4xl sm:text-5xl font-bold font-cyber mb-6 text-transparent bg-clip-text bg-gradient-to-r from-green-400 to-blue-500 glow-text-green text-center">
            XOX Siber
        </h1>

        <div class="flex justify-around w-full max-w-sm mb-6 text-xl font-cyber">
            <div class="text-green-400 flex items-center gap-2">
                Pemain (X): <span id="playerXScore" class="glow-text-green">0</span>
            </div>
            <div class="text-blue-400 flex items-center gap-2">
                AI (O): <span id="playerOScore" class="glow-text-blue">0</span>
            </div>
        </div>

        <div class="flex flex-col sm:flex-row items-center justify-center gap-4 mb-8">
            <div id="coinDisplay" class="current-coins">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="w-6 h-6 text-yellow-400">
                    <path fill-rule="evenodd" d="M12 2.25c-5.385 0-9.75 4.365-9.75 9.75s4.365 9.75 9.75 9.75 9.75-4.365 9.75-9.75S17.385 2.25 12 2.25ZM12.75 6a.75.75 0 0 0-1.5 0v6c0 .414.336.75.75.75h4.5a.75.75 0 0 0 0-1.5h-3.75V6Z" clip-rule="evenodd" />
                </svg>
                <span id="playerCoins">0</span> Koin
            </div>
            <button id="openShopBtn" class="bg-purple-600 hover:bg-purple-700 text-white font-bold py-2 px-4 rounded glow-button font-cyber">
                Toko Skin
            </button>
        </div>


        <div id="gameBoard" class="grid grid-custom-cols gap-1 bg-gray-800 p-2 rounded-lg shadow-lg glow-border-blue" style="--board-size: 5;">
            </div>

        <div class="mt-8 text-center">
            <p id="gameStatus" class="text-2xl font-cyber mb-4 text-green-400 glow-text-green">Pilih mode permainan</p>
            <div class="flex flex-wrap justify-center gap-4">
                <button id="onePlayerBtn" class="bg-violet-600 hover:bg-violet-700 text-white font-bold py-3 px-6 rounded glow-button font-cyber text-lg">
                    1 Pemain (vs AI)
                </button>
                <button id="twoPlayerBtn" class="bg-violet-600 hover:bg-violet-700 text-white font-bold py-3 px-6 rounded glow-button font-cyber text-lg">
                    2 Pemain (Lokal)
                </button>
                <button id="resetBtn" class="bg-red-600 hover:bg-red-700 text-white font-bold py-3 px-6 rounded glow-button font-cyber text-lg hidden">
                    Reset Game
                </button>
            </div>
        </div>

        <div id="rewardPopup" class="reward-popup hidden">
            <div class="reward-popup-content flex flex-col items-center">
                <h2 class="text-3xl font-cyber text-blue-400 glow-text-blue mb-4">SELAMAT!</h2>
                <p class="text-xl font-cyber text-gray-300 mb-6">Anda mendapatkan <span id="rewardCoinsAmount" class="text-green-400 glow-text-green font-bold">100</span> Koin!</p>
                <button id="watchAdBtn" class="bg-green-600 hover:bg-green-700 text-white font-bold py-3 px-6 rounded glow-button font-cyber text-lg">
                    Tonton Iklan (Dapatkan Koin!)
                </button>
                <button id="skipRewardBtn" class="bg-gray-600 hover:bg-gray-700 text-white font-bold py-2 px-4 rounded mt-3 font-cyber text-sm">
                    Lewati (Tidak Dapat Koin)
                </button>
            </div>
        </div>

        <div id="shopModal" class="shop-modal hidden">
            <div class="shop-modal-content">
                <h2 class="text-3xl font-cyber text-purple-400 glow-text-blue mb-4">Toko Skin XOX Siber</h2>
                <div id="shopCoinDisplay" class="current-coins">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="w-6 h-6 text-yellow-400">
                        <path fill-rule="evenodd" d="M12 2.25c-5.385 0-9.75 4.365-9.75 9.75s4.365 9.75 9.75 9.75 9.75-4.365 9.75-9.75S17.385 2.25 12 2.25ZM12.75 6a.75.75 0 0 0-1.5 0v6c0 .414.336.75.75.75h4.5a.75.75 0 0 0 0-1.5h-3.75V6Z" clip-rule="evenodd" />
                    </svg>
                    <span id="shopPlayerCoins">0</span> Koin Anda
                </div>

                <div class="shop-items-grid" id="shopItemsGrid">
                    </div>

                <button id="closeShopBtn" class="bg-red-600 hover:bg-red-700 text-white font-bold py-2 px-4 rounded glow-button font-cyber mt-4">
                    Tutup Toko
                </button>
            </div>
        </div>

    </div>

    <script>
        // --- Monetag Integration (KEEP AS IS) ---
        // Your Monetag scripts are already placed correctly at the beginning of the body.
        // Example: <script async="async" data-cfasync="false" src="//your.monetag.vignette.script.js"></script>
        // <script async="async" data-cfasync="false" src="//your.monetag.popunder.script.js"></script>
        // Ensure you replace "//your.monetag.vignette.script.js" and "//your.monetag.popunder.script.js"
        // with the actual script URLs provided by your Monetag account.
        // For the "Watch Ad" button, you will need to use Monetag's Direct Link.
        // The placeholder `YOUR_MONETAG_DIRECT_LINK_URL_HERE` below should be replaced.
        const MONETAG_DIRECT_LINK = 'YOUR_MONETAG_DIRECT_LINK_URL_HERE'; // GANTI DENGAN DIRECT LINK MONETAG ANDA!

        // --- Game Core Logic ---
        const gameBoard = document.getElementById('gameBoard');
        const gameStatus = document.getElementById('gameStatus');
        const onePlayerBtn = document.getElementById('onePlayerBtn');
        const twoPlayerBtn = document.getElementById('twoPlayerBtn');
        const resetBtn = document.getElementById('resetBtn');
        const playerXScoreSpan = document.getElementById('playerXScore');
        const playerOScoreSpan = document.getElementById('playerOScore');
        const rewardPopup = document.getElementById('rewardPopup');
        const watchAdBtn = document.getElementById('watchAdBtn');
        const skipRewardBtn = document.getElementById('skipRewardBtn');
        const rewardCoinsAmountSpan = document.getElementById('rewardCoinsAmount');

        // --- Shop Elements ---
        const openShopBtn = document.getElementById('openShopBtn');
        const shopModal = document.getElementById('shopModal');
        const closeShopBtn = document.getElementById('closeShopBtn');
        const shopItemsGrid = document.getElementById('shopItemsGrid');
        const playerCoinsDisplay = document.getElementById('playerCoins');
        const shopPlayerCoinsDisplay = document.getElementById('shopPlayerCoins');

        const BOARD_SIZE = 5;
        const WIN_CONDITION = 4; // 4 in a row for 5x5 board
        let board = [];
        let currentPlayer = 'X';
        let isGameActive = false;
        let gameMode = null; // '1-player' or '2-player'
        let playerXScore = 0;
        let playerOScore = 0;
        let turnCount = 0; // To track turns for AI difficulty (optional)
        const REWARD_COINS_PER_WIN = 100; // Koin yang didapat per kemenangan

        // --- Koin dan Skin Logic (BARU) ---
        let playerCoins = parseInt(localStorage.getItem('xoxSiberCoins') || '0');

        // Definisi Skin
        // CATATAN: GANTI URL GAMBAR DENGAN URL PUBLIK ASLI ANDA!
        const skins = [
            { id: 'defaultX', type: 'X', name: 'X Default', imageUrl: 'https://cs.gstatic.com/gemini/multimodality/tic-tac-toe-x.svg', cost: 0, unlocked: true },
            { id: 'defaultO', type: 'O', name: 'O Default', imageUrl: 'https://cs.gstatic.com/gemini/multimodality/tic-tac-toe-o.svg', cost: 0, unlocked: true },
            { id: 'xSwords', type: 'X', name: 'Pedang Siber', imageUrl: 'URL_GAMBAR_X_SWORDS_ANDA_DI_SINI', cost: 500, unlocked: false }, // GANTI URL INI
            { id: 'oShield', type: 'O', name: 'Perisai Siber', imageUrl: 'URL_GAMBAR_O_SHIELD_ANDA_DI_SINI', cost: 500, unlocked: false }, // GANTI URL INI
            { id: 'xStaffs', type: 'X', name: 'Tongkat Kristal', imageUrl: 'URL_GAMBAR_X_STAFFS_ANDA_DI_SINI', cost: 1200, unlocked: false }, // GANTI URL INI
            { id: 'oPotion', type: 'O', name: 'Ramuan Energi', imageUrl: 'URL_GAMBAR_O_POTION_ANDA_DI_SINI', cost: 1200, unlocked: false }, // GANTI URL INI
            // Contoh Tema Papan (membutuhkan implementasi CSS tambahan)
            { id: 'boardNeon', type: 'Board', name: 'Papan Neon', cost: 1500, unlocked: false,
              description: 'Papan dengan garis-garis neon yang menyala. (Membutuhkan pengembangan lebih lanjut untuk CSS)' },
            // Contoh Efek Visual (membutuhkan implementasi JS/CSS tambahan)
            { id: 'effectSparkle', type: 'Effect', name: 'Efek Berkilau', cost: 700, unlocked: false,
              description: 'Efek percikan cahaya saat menempatkan simbol. (Membutuhkan pengembangan lebih lanjut)' },
            // Contoh Power-up (membutuhkan modifikasi gameplay inti)
            { id: 'powerUpUndo', type: 'PowerUp', name: 'Undo Terbatas', cost: 300, unlocked: false,
              description: 'Kemampuan membatalkan satu langkah per game. (Membutuhkan pengembangan lebih lanjut pada logika game)' }
        ];

        // Load unlocked and selected skins from localStorage
        let unlockedSkins = JSON.parse(localStorage.getItem('unlockedSkins')) || {};
        let currentXSkinId = localStorage.getItem('currentXSkinId') || 'defaultX';
        let currentOSkinId = localStorage.getItem('currentOSkinId') || 'defaultO';

        function loadSkins() {
            skins.forEach(skin => {
                if (unlockedSkins[skin.id]) {
                    skin.unlocked = true;
                }
            });
        }

        function saveSkins() {
            localStorage.setItem('unlockedSkins', JSON.stringify(unlockedSkins));
            localStorage.setItem('currentXSkinId', currentXSkinId);
            localStorage.setItem('currentOSkinId', currentOSkinId);
        }

        function updateCoinDisplay() {
            playerCoinsDisplay.textContent = playerCoins;
            shopPlayerCoinsDisplay.textContent = playerCoins;
            localStorage.setItem('xoxSiberCoins', playerCoins);
        }

        function getCurrentSkinUrl(player) {
            const skinId = player === 'X' ? currentXSkinId : currentOSkinId;
            const skin = skins.find(s => s.id === skinId);
            return skin ? skin.imageUrl : ''; // Return empty if not found, should not happen with defaults
        }

        // --- Game Initialization ---
        function createBoard() {
            gameBoard.innerHTML = '';
            gameBoard.style.setProperty('--board-size', BOARD_SIZE);
            board = Array(BOARD_SIZE).fill(null).map(() => Array(BOARD_SIZE).fill(''));

            for (let i = 0; i < BOARD_SIZE; i++) {
                for (let j = 0; j < BOARD_SIZE; j++) {
                    const cell = document.createElement('div');
                    cell.classList.add('game-cell', 'flex', 'items-center', 'justify-center', 'text-4xl', 'font-bold', 'cursor-pointer', 'rounded-sm', 'relative');
                    cell.style.backgroundColor = '#1F2937'; // gray-800 default
                    cell.style.border = '1px solid #4B5563'; // gray-600
                    cell.dataset.row = i;
                    cell.dataset.col = j;
                    cell.addEventListener('click', handleCellClick);
                    gameBoard.appendChild(cell);
                }
            }
        }

        function startGame(mode) {
            gameMode = mode;
            isGameActive = true;
            currentPlayer = 'X';
            gameStatus.textContent = gameMode === '1-player' ? 'Giliran Anda (X)' : 'Giliran Pemain X';
            resetBtn.classList.remove('hidden');
            onePlayerBtn.classList.add('hidden');
            twoPlayerBtn.classList.add('hidden');
            createBoard();
        }

        function resetGame() {
            createBoard();
            currentPlayer = 'X';
            isGameActive = true;
            gameStatus.textContent = gameMode === '1-player' ? 'Giliran Anda (X)' : 'Giliran Pemain X';
            turnCount = 0;
        }

        // --- Game Play Logic ---
        function handleCellClick(event) {
            if (!isGameActive) return;

            const row = parseInt(event.target.dataset.row);
            const col = parseInt(event.target.dataset.col);

            if (board[row][col] === '') {
                makeMove(row, col, currentPlayer);
            }
        }

        function makeMove(row, col, player) {
            board[row][col] = player;
            drawMark(row, col, player);
            turnCount++;

            if (checkWin(player)) {
                endGame(player);
            } else if (checkDraw()) {
                endGame('draw');
            } else {
                switchPlayer();
                if (gameMode === '1-player' && currentPlayer === 'O') {
                    // AI's turn
                    gameStatus.textContent = 'Giliran AI (O)';
                    setTimeout(aiMove, 700); // Delay AI move for better UX
                } else {
                    gameStatus.textContent = `Giliran Pemain ${currentPlayer}`;
                }
            }
        }

        function drawMark(row, col, mark) {
            const cell = gameBoard.children[row * BOARD_SIZE + col];
            const img = document.createElement('img');
            img.src = getCurrentSkinUrl(mark);
            img.alt = mark;
            cell.innerHTML = ''; // Clear existing content
            cell.appendChild(img);
        }


        function checkWin(player) {
            // Check rows, columns, and diagonals for WIN_CONDITION in a row
            // Simplified check, needs proper 5x5 + 4-in-a-row logic
            // This part is complex for a generic solution, you might need a more robust algorithm like:
            // https://github.com/react-tictactoe/react-tictactoe/blob/master/src/Board.js#L141
            // For now, a basic check that needs to be expanded for all directions and WIN_CONDITION

            // Example (this is a very basic placeholder, not a full solution for Connect-N on a large board):
            // It just checks if the board is filled, which is not winning. A full Connect-N algorithm is needed.
            const directions = [
                { dr: 0, dc: 1 }, // Horizontal
                { dr: 1, dc: 0 }, // Vertical
                { dr: 1, dc: 1 }, // Diagonal down-right
                { dr: 1, dc: -1 } // Diagonal down-left
            ];

            for (let r = 0; r < BOARD_SIZE; r++) {
                for (let c = 0; c < BOARD_SIZE; c++) {
                    if (board[r][c] === player) {
                        for (const { dr, dc } of directions) {
                            let count = 0;
                            for (let k = 0; k < WIN_CONDITION; k++) {
                                const newR = r + k * dr;
                                const newC = c + k * dc;
                                if (newR >= 0 && newR < BOARD_SIZE && newC >= 0 && newC < BOARD_SIZE && board[newR][newC] === player) {
                                    count++;
                                } else {
                                    break;
                                }
                            }
                            if (count === WIN_CONDITION) {
                                return true;
                            }
                        }
                    }
                }
            }
            return false;
        }

        function checkDraw() {
            // Check if all cells are filled
            return board.flat().every(cell => cell !== '');
        }

        function endGame(winner) {
            isGameActive = false;
            if (winner === 'draw') {
                gameStatus.textContent = 'Seri!';
            } else {
                gameStatus.textContent = `Pemain ${winner} Menang!`;
                if (winner === 'X') {
                    playerXScore++;
                    playerXScoreSpan.textContent = playerXScore;
                    showRewardPopup(); // Show reward for winning against AI
                } else {
                    playerOScore++;
                    playerOScoreSpan.textContent = playerOScore;
                }
            }
        }

        function switchPlayer() {
            currentPlayer = currentPlayer === 'X' ? 'O' : 'X';
        }

        // --- AI Logic (Minimax placeholder) ---
        function aiMove() {
            // Very simplified AI: finds the first empty spot.
            // For a real Tic-Tac-Toe AI, you'd use Minimax algorithm here.
            // The provided original code might have a more advanced AI.
            // This is a placeholder.
            let bestMove = null;

            // Simple AI: Find the first empty cell
            for (let i = 0; i < BOARD_SIZE; i++) {
                for (let j = 0; j < BOARD_SIZE; j++) {
                    if (board[i][j] === '') {
                        bestMove = { row: i, col: j };
                        break;
                    }
                }
                if (bestMove) break;
            }

            if (bestMove) {
                makeMove(bestMove.row, bestMove.col, 'O');
            }
        }

        // --- Reward Popup Logic ---
        function showRewardPopup() {
            rewardCoinsAmountSpan.textContent = REWARD_COINS_PER_WIN;
            rewardPopup.classList.remove('hidden');
        }

        function hideRewardPopup() {
            rewardPopup.classList.add('hidden');
        }

        watchAdBtn.addEventListener('click', () => {
            // Open Monetag Direct Link
            window.open(MONETAG_DIRECT_LINK, '_blank');
            playerCoins += REWARD_COINS_PER_WIN;
            updateCoinDisplay();
            hideRewardPopup();
            resetGame(); // Reset game after reward
        });

        skipRewardBtn.addEventListener('click', () => {
            hideRewardPopup();
            resetGame(); // Reset game without reward
        });


        // --- Shop Logic (BARU) ---
        openShopBtn.addEventListener('click', () => {
            renderShopItems();
            shopModal.classList.remove('hidden');
        });

        closeShopBtn.addEventListener('click', () => {
            shopModal.classList.add('hidden');
            // Re-render coin display on main screen in case it changed
            updateCoinDisplay();
        });

        function renderShopItems() {
            shopItemsGrid.innerHTML = '';
            shopPlayerCoinsDisplay.textContent = playerCoins; // Update coin display in shop

            skins.forEach(skin => {
                const itemDiv = document.createElement('div');
                itemDiv.classList.add('shop-item', 'border', 'border-gray-600', 'rounded-lg', 'p-3', 'flex', 'flex-col', 'items-center', 'gap-2', 'cursor-pointer', 'transition-all', 'duration-200');
                itemDiv.dataset.skinId = skin.id;
                itemDiv.dataset.skinType = skin.type;

                // Add unlocked class
                if (skin.unlocked) {
                    itemDiv.classList.add('unlocked');
                }

                // Add selected class if applicable
                if (skin.id === currentXSkinId || skin.id === currentOSkinId) {
                    itemDiv.classList.add('selected');
                }

                if (skin.imageUrl) {
                    const img = document.createElement('img');
                    img.src = skin.imageUrl;
                    img.alt = skin.name;
                    itemDiv.appendChild(img);
                } else {
                    // Placeholder for items without images (e.g., themes, effects)
                    const placeholder = document.createElement('div');
                    placeholder.classList.add('w-20', 'h-20', 'bg-gray-700', 'flex', 'items-center', 'justify-center', 'rounded');
                    placeholder.textContent = skin.name[0]; // First letter
                    placeholder.style.fontSize = '2rem';
                    itemDiv.appendChild(placeholder);
                }

                const nameP = document.createElement('p');
                nameP.classList.add('font-bold', 'text-gray-200');
                nameP.textContent = skin.name;
                itemDiv.appendChild(nameP);

                const typeSpan = document.createElement('span');
                typeSpan.classList.add('text-xs', 'text-gray-400', 'uppercase');
                typeSpan.textContent = `Tipe: ${skin.type}`;
                itemDiv.appendChild(typeSpan);

                if (skin.description) {
                    const descP = document.createElement('p');
                    descP.classList.add('text-xs', 'text-gray-500', 'mt-1');
                    descP.textContent = skin.description;
                    itemDiv.appendChild(descP);
                }


                if (!skin.unlocked) {
                    const priceDiv = document.createElement('div');
                    priceDiv.classList.add('shop-item-price');
                    priceDiv.innerHTML = `
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                            <path fill-rule="evenodd" d="M12 2.25c-5.385 0-9.75 4.365-9.75 9.75s4.365 9.75 9.75 9.75 9.75-4.365 9.75-9.75S17.385 2.25 12 2.25ZM12.75 6a.75.75 0 0 0-1.5 0v6c0 .414.336.75.75.75h4.5a.75.75 0 0 0 0-1.5h-3.75V6Z" clip-rule="evenodd" />
                        </svg>
                        <span>${skin.cost}</span>
                    `;
                    itemDiv.appendChild(priceDiv);

                    const buyBtn = document.createElement('button');
                    buyBtn.classList.add('buy-button');
                    buyBtn.textContent = 'Beli';
                    buyBtn.addEventListener('click', (e) => {
                        e.stopPropagation(); // Prevent itemDiv click event
                        buySkin(skin.id);
                    });
                    itemDiv.appendChild(buyBtn);
                } else {
                    if (skin.type === 'X' || skin.type === 'O') { // Only for X/O skins
                        const statusP = document.createElement('p');
                        statusP.classList.add('unlocked-text');
                        statusP.textContent = 'Dibuka!';
                        itemDiv.appendChild(statusP);

                        const selectBtn = document.createElement('button');
                        selectBtn.classList.add('select-button');
                        selectBtn.textContent = 'Pilih';

                        if ((skin.type === 'X' && skin.id === currentXSkinId) || (skin.type === 'O' && skin.id === currentOSkinId)) {
                            selectBtn.textContent = 'Terpilih';
                            selectBtn.disabled = true;
                            selectBtn.classList.remove('select-button'); // Remove hover effect
                            selectBtn.classList.add('bg-gray-700', 'text-gray-400', 'cursor-not-allowed');
                        } else {
                            selectBtn.addEventListener('click', (e) => {
                                e.stopPropagation(); // Prevent itemDiv click event
                                selectSkin(skin.id, skin.type);
                            });
                        }
                        itemDiv.appendChild(selectBtn);
                    } else { // For other types like Board, Effect, PowerUp
                         const statusP = document.createElement('p');
                        statusP.classList.add('unlocked-text');
                        statusP.textContent = 'Dibuka!';
                        itemDiv.appendChild(statusP);
                    }
                }
                shopItemsGrid.appendChild(itemDiv);
            });
        }

        function buySkin(skinId) {
            const skin = skins.find(s => s.id === skinId);
            if (!skin) return;

            if (playerCoins >= skin.cost) {
                playerCoins -= skin.cost;
                skin.unlocked = true;
                unlockedSkins[skin.id] = true; // Mark as unlocked in storage object
                updateCoinDisplay();
                saveSkins();
                renderShopItems(); // Re-render shop to update status
                alert(`Anda berhasil membeli ${skin.name}!`);
            } else {
                alert(`Koin tidak cukup untuk membeli ${skin.name}. Anda perlu ${skin.cost - playerCoins} koin lagi.`);
            }
        }

        function selectSkin(skinId, type) {
            const skin = skins.find(s => s.id === skinId);
            if (!skin || !skin.unlocked) return; // Must be unlocked to select

            if (type === 'X') {
                currentXSkinId = skinId;
            } else if (type === 'O') {
                currentOSkinId = skinId;
            }
            saveSkins();
            renderShopItems(); // Re-render shop to update selected status
            alert(`${skin.name} berhasil dipilih untuk simbol ${type}!`);
            // Optionally, update board immediately if game is active
            if (isGameActive) {
                // Force redraw all marks with new skins
                for(let r=0; r<BOARD_SIZE; r++) {
                    for(let c=0; c<BOARD_SIZE; c++) {
                        if (board[r][c] !== '') {
                            drawMark(r, c, board[r][c]);
                        }
                    }
                }
            }
        }

        // --- Event Listeners ---
        onePlayerBtn.addEventListener('click', () => startGame('1-player'));
        twoPlayerBtn.addEventListener('click', () => startGame('2-player'));
        resetBtn.addEventListener('click', resetGame);

        // Initial setup
        loadSkins();
        updateCoinDisplay(); // Initial display of coins
        createBoard(); // Initial board rendering (empty)

    </script>
</body>
</html>
